<!DOCTYPE html>
<html lang="tl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ricardo's Adventure</title>
<style>
body{font-family:sans-serif;text-align:center;background:#f7e7b5;margin:0}
h2{margin:10px}
#gameBox{position:relative;margin:auto;border:5px solid #b48c00;width:320px;height:320px;background:#f9eab3}
.player,.npc,.item{position:absolute;width:20px;height:20px;border-radius:3px}
.player{background:#0077cc}
.npc{background:#d33}
.item{background:#fff;border:2px solid #555}
.nameTag{position:absolute;font-size:10px;white-space:nowrap}
#joystick{position:fixed;bottom:10px;left:10px;width:120px;height:120px;border-radius:50%;background:#f3d27a;opacity:.8;display:flex;align-items:center;justify-content:center}
#stick{width:50px;height:50px;border-radius:50%;background:#f0b32d}
#msg{margin:5px;padding:5px;border:2px solid #d1a700;display:inline-block;background:#fff}
#next,#again,#exit{display:none;margin-top:10px;background:#f0b32d;padding:5px 15px;border:none;border-radius:6px}
</style>
</head>
<body>
<h2>ğŸ‡µğŸ‡­ Ricardo's Adventure</h2>
<div id="msg"></div>
<div id="gameBox"></div>
<button id="next">Magpatuloy</button>
<div>
<button id="again">Maglaro ulit</button>
<button id="exit">Lumabas</button>
</div>
<div id="joystick"><div id="stick"></div></div>

<script>
const levels=[
 {city:"Manila",npc:"Jose Rizal",task:"Kolektahin ang 3 items!",goal:3,icon:["ğŸ“œ","âœ‰ï¸","ğŸ•Šï¸"]},
 {city:"Quezon",npc:"Manuel L. Quezon",task:"Maghanap ng 3 libro!",goal:3,icon:["ğŸ“˜","ğŸ“—","ğŸ“™"]},
 {city:"Nueva Ecija",npc:"Emilio Jacinto",task:"Kolektahin ang 2 espada!",goal:2,icon:["âš”ï¸","ğŸ—¡ï¸"]},
 {city:"Cavite",npc:"Andres Bonifacio",task:"Hanapin ang 4 bandera!",goal:4,icon:["ğŸš©","ğŸ´","ğŸ","ğŸ³ï¸"]},
 {city:"Laguna",npc:"Apolinario Mabini",task:"Kolektahin ang 5 bituin!",goal:5,icon:["â­","ğŸŒŸ","âœ¨","ğŸ’«","ğŸŒ "]}
];
let level=0,items=[],collected=0,player,npc;
const box=document.getElementById("gameBox"),msg=document.getElementById("msg");
const next=document.getElementById("next"),again=document.getElementById("again"),exit=document.getElementById("exit");

function setup(){
 box.innerHTML="";
 again.style.display="none";exit.style.display="none";
 let L=levels[level];
 msg.innerHTML=`${L.npc}: ${L.task} (${L.city})`;
 player=make("player","Ricardo",30,30);
 npc=make("npc",L.npc,140,140);
 collected=0;items=[];
 for(let i=0;i<L.goal;i++){
  let it=make("item",L.icon[i],Math.random()*280,Math.random()*280);
  items.push(it);
 }
 next.style.display="none";
}

function make(cls,text,x,y){
 let d=document.createElement("div");d.className=cls;
 d.style.left=x+"px";d.style.top=y+"px";
 box.appendChild(d);
 let tag=document.createElement("div");
 tag.className="nameTag";tag.textContent=text;
 tag.style.left=(x-5)+"px";tag.style.top=(y-12)+"px";
 box.appendChild(tag);
 d.tag=tag;
 return d;
}

function move(obj,dx,dy){
 let nx=parseFloat(obj.style.left)+dx,ny=parseFloat(obj.style.top)+dy;
 nx=Math.max(0,Math.min(300,nx));ny=Math.max(0,Math.min(300,ny));
 obj.style.left=nx+"px";obj.style.top=ny+"px";
 obj.tag.style.left=(nx-5)+"px";obj.tag.style.top=(ny-12)+"px";
 checkCollect();
}

function checkCollect(){
 items.forEach(it=>{
  if(!it.collected && collide(player,it)){
   it.style.display="none";it.tag.style.display="none";
   it.collected=true;collected++;
   if(collected===levels[level].goal)finish();
  }
 });
}

function collide(a,b){
 let ax=parseFloat(a.style.left),ay=parseFloat(a.style.top),
 bx=parseFloat(b.style.left),by=parseFloat(b.style.top);
 return Math.abs(ax-bx)<20 && Math.abs(ay-by)<20;
}

function finish(){
 msg.innerHTML="âœ… Mission complete!";
 next.style.display="inline-block";
}

next.onclick=()=>{
 level++;
 if(level<levels.length)setup();
 else endGame();
};

function endGame(){
 box.innerHTML="";
 msg.innerHTML="ğŸ‰ Ikaw ay nanalo na!";
 again.style.display="inline-block";exit.style.display="inline-block";
}

again.onclick=()=>{level=0;setup();}
exit.onclick=()=>{msg.innerHTML="Salamat sa paglalaro!";again.style.display="none";exit.style.display="none";};

// joystick
let joy=document.getElementById("joystick"),stick=document.getElementById("stick");
let joyActive=false;
stick.addEventListener("touchstart",()=>{joyActive=true});
stick.addEventListener("touchend",()=>{joyActive=false;stick.style.transform="translate(0,0)"});
stick.addEventListener("touchmove",e=>{
 e.preventDefault();
 if(!joyActive)return;
 let t=e.touches[0];
 let rect=joy.getBoundingClientRect();
 let dx=t.clientX-(rect.left+60),dy=t.clientY-(rect.top+60);
 let len=Math.sqrt(dx*dx+dy*dy);
 if(len>40){dx*=40/len;dy*=40/len;}
 stick.style.transform=`translate(${dx}px,${dy}px)`;
 move(player,dx*0.1,dy*0.1);
});

// keyboard
document.addEventListener("keydown",e=>{
 let s=5;
 if(e.key=="ArrowUp"||e.key=="w")move(player,0,-s);
 if(e.key=="ArrowDown"||e.key=="s")move(player,0,s);
 if(e.key=="ArrowLeft"||e.key=="a")move(player,-s,0);
 if(e.key=="ArrowRight"||e.key=="d")move(player,s,0);
});

setup();
</script>
</body>
</html>